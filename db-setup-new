CREATE TABLE users (
	id SERIAL PRIMARY KEY,
	username TEXT,
	-- email TEXT,
	role INT,
	password TEXT
);

CREATE TABLE boards (
	id SERIAL PRIMARY KEY,
	board_name TEXT,
)

CREATE TABLE messages (
	id SERIAL PRIMARY KEY,
	board_id INT REFERENCES boards(id),
	user_id INT REFERENCES users(id),
	upload_time TIMESTAMP,
	content TEXT);

CREATE TABLE uploads (id SERIAL PRIMARY KEY, user_id INT REFERENCES messages(id), upload_time TIMESTAMP, filepath TEXT, filename TEXT)

CREATE ROLE app WITH PASSWORD 'INSERT PASS';

GRANT CONNECT ON DATABASE "music-app" TO app;

GRANT INSERT ON messages TO app;
GRANT SELECT ON messages TO app;
GRANT SELECT, INSERT ON users TO app;
GRANT USAGE ON SEQUENCE messages_id_seq, users_id_seq TO app;


-- Other useful comments
with user_data AS (
	SELECT id FROM users WHERE username = 'namename'
)
INSERT INTO uploads (user_id, upload_time, filepath, filename) VALUES ((SELECT id from user_data), NOW()::TIMESTAMP, 'data/', 'test.txt');
